<mat-chip (click)="toggle()" (removed)="value$.next(undefined)">
  <mat-icon matChipAvatar *ngIf="hasValue">check</mat-icon>
  <ng-template [ngIf]="!hasValue">
    {{ label }}
  </ng-template>
  <ng-template [ngIf]="hasValue">
    <ng-content></ng-content>
  </ng-template>
  <div class="hidden" cdkOverlayOrigin #trigger="cdkOverlayOrigin"></div>
  <ng-template
    cdkConnectedOverlay
    cdkConnectedOverlayLockPosition
    cdkConnectedOverlayHasBackdrop
    cdkConnectedOverlayBackdropClass="cdk-overlay-transparent-backdrop"
    [cdkConnectedOverlayOrigin]="trigger"
    [cdkConnectedOverlayOpen]="isOpen"
    (backdropClick)="toggle()"
  >
    <form class="flex" autocomplete="off" (ngSubmit)="save()">
      <div class="mat-menu-panel">
        <mat-form-field>
          <mat-label>{{ label }}</mat-label>
          <input matInput type="text" [(ngModel)]="value" [ngModelOptions]="{ standalone: true }" />
        </mat-form-field>
        <button mat-stroked-button type="submit" color="primary">Filter</button>
      </div>
    </form>
  </ng-template>
  <button matChipRemove *ngIf="hasValue">
    <mat-icon>cancel</mat-icon>
  </button>
</mat-chip>
